<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.6.0/remixicon.min.css">
    <link rel="stylesheet" href="/css/index.css">
    <link rel="stylesheet" href="/css/swiper-bundle.min.css">

    <title>Supermarket App</title>
  </head>

  <body>

    <%- include('partials/navbar') %>

    <div class="container mt-4">
      <p class="text-center">
        <% if (user) { %>
          <% if (user.role === "admin") { %>
            <br>
            Back to <a href="/inventory">inventory!</a>
          <% } else { %>
            <br>
            Continue <a href="/shopping">Shopping!</a>
          <% } %>
        <% } else { %>
          <br>
          Welcome to supermarket app! <br>
          Please <a href="/login">login</a> to continue...
        <% } %>
      </p>
    </div>

          <!--Hero video carousel-->
          <section class="hero-carousel swiper">
            
            <div class="swiper-wrapper">

              <!-- Slide 1 -->
              <div class="swiper-slide">
                <video class="hero-video" src="/video/index1.mp4" autoplay muted loop playsinline></video>
              </div>

              <!-- Slide 2 (Optional) -->
              <div class="swiper-slide">
                <video class="hero-video" src="/video/index2.mp4" autoplay muted loop playsinline></video>
              </div>

              <!-- Slide 3 (Optional) -->
              <div class="swiper-slide">
                <video class="hero-video" src="/video/index3.mp4" autoplay muted loop playsinline></video>
              </div>

            </div>

            <!-- Pagination dots -->
            <div class="swiper-pagination"></div>

            <!-- Navigation arrows -->
            <div class="swiper-button-prev"></div>
            <div class="swiper-button-next"></div>

          </section>





    <section class="testimonial">
      <h2 class="testimonial__title">WHAT <br> CUSTOMERS SAY</h2>

      <div class="container">
        <div class="testimonial__swiper swiper">  <!-- MUST contain button + pagination -->

          <!-- SLIDES -->
          <div class="swiper-wrapper">
            <% reviews.forEach(review => { %>
              <article class="testimonial__card swiper-slide">
                  <img src="/images/default-avatar.png" class="testimonial__img">

                  <h3 class="testimonial__name"><%= review.username %></h3>

                  <div class="testimonial__rating">
                    <span class="testimonial__stars">
                      <% for (let i = 1; i <= 5; i++) { %>
                        <%= i <= review.rating ? "★" : "☆" %>
                      <% } %>
                    </span>
                    <span class="testimonial__score"><%= review.rating.toFixed(1) %></span>
                  </div>

                  <p class="testimonial__description">"<%= review.comment %>"</p>
                  <p class="testimonial__date"><%= new Date(review.created_at).toLocaleDateString() %></p>
              </article>
            <% }) %>
          </div>

          <!-- Pagination + Arrows MUST be inside swiper -->
          <div class="swiper-pagination"></div>

          <div class="swiper-button-prev"><i class="ri-arrow-left-line"></i></div>
          <div class="swiper-button-next"><i class="ri-arrow-right-line"></i></div>

        </div>
      </div>
    </section>


    <!-- FIX: Proper script tag -->
    <script src="/swiper-bundle.min.js"></script>

    
    <script>
      // FIX: Corrected property names (camelCase)
      const swiperTestimonial = new Swiper('.testimonial__swiper', {
        loop: true,
        slidesPerView: 1,
        centeredSlides: false,
        spaceBetween: 30,
        grabCursor: true,
        speed: 600,

        pagination: {
          el: '.swiper-pagination',
          clickable: true,
        },

        navigation: {
          nextEl: '.swiper-button-next',
          prevEl: '.swiper-button-prev',
        },

        autoplay: {
          delay: 3000,
          disableOnInteraction: false,
        },

        // Show multiple slides on larger screens
        breakpoints: {
          640: {
            slidesPerView: 1,
            spaceBetween: 20
          },
          768: {
            slidesPerView: 2,
            spaceBetween: 25
          },
          1024: {
            slidesPerView: 3,
            spaceBetween: 30
          }
        }
      });
    </script>

    <script>
      const swiperHero = new Swiper('.hero-carousel', {
        loop: true,
        slidesPerView: 1,
        spaceBetween: 0,
        speed: 900,
        effect: "fade",

        autoplay: {
          delay: 5000,
          disableOnInteraction: false,
        },

        pagination: {
          el: '.hero-carousel .swiper-pagination',
          clickable: true
        },

        navigation: {
          nextEl: '.hero-carousel .swiper-button-next',
          prevEl: '.hero-carousel .swiper-button-prev'
        }
      });
    </script>


    <%- include('partials/footer') %>
  </body>
</html>