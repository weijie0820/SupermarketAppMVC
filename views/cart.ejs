<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>Your Cart</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  </head>
    <body>

    <%- include('partials/navbar') %>


        <div class="container mt-4">
          <h2>Your Cart</h2>

          <% if (cart.length === 0) { %>
              <p>Your cart is empty.</p>
          <% } else { %> 

              <form action="/cart/update-multiple" method="POST">
            <table class="table table-bordered text-center">
                <thead>
                    <tr>
                        <th><input type="checkbox" id="selectAll"></th>
                        <th>Product</th>
                        <th>Image</th>
                        <th>Quantity</th>
                        <th>Total</th>
                        <th>Action</th>
                    </tr>
                </thead>

                <tbody>
                    <% cart.forEach(item => { %>
                    <tr>
                        <td>
                            <input type="checkbox" name="selectedProducts" value="<%= item.product_id %>" class="selectItem">
                        </td>

                        <td><%= item.productName %></td>

                        <td>
                            <img src="/images/<%= item.image %>" style="width:60px">
                        </td>

                        <td class="d-flex justify-content-center gap-2">

                            <button 
                                formaction="/cart/decrease/<%= item.product_id %>" 
                                formmethod="POST"
                                class="btn btn-outline-danger btn-sm">
                                -
                            </button>

                            <input 
                                type="number" 
                                name="quantities[<%= item.product_id %>]" 
                                value="<%= item.quantity %>" 
                                min="1" 
                                max="<%= item.stock %>"
                                class="form-control text-center"
                                style="width: 70px;"
                            >

                            <button 
                                formaction="/cart/increase/<%= item.product_id %>" 
                                formmethod="POST"
                                class="btn btn-outline-success btn-sm">
                                +
                            </button>

                            <button 
                                formaction="/cart/update/<%= item.product_id %>"
                                formmethod="POST"
                                class="btn btn-primary btn-sm">
                                Update
                            </button>

                        </td>

                        <td>$<%= (item.price * item.quantity).toFixed(2) %></td>

                        <td>
                            <button 
                                formaction="/cart/remove/<%= item.product_id %>" 
                                formmethod="POST"
                                class="btn btn-danger">
                                Remove
                            </button>
                        </td>
                    </tr>
                    <% }) %>
                </tbody>
            </table>
            </form>
            <% } %>

          <script>
          // Select All logic
          document.getElementById("selectAll").addEventListener("change", function() {
              document.querySelectorAll(".selectItem").forEach(cb => {
                  cb.checked = this.checked;
              });
          });
          </script>

        </div>

    </body>
</html>
